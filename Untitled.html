<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Gym Log</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better look and feel */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .container {
            max-width: 900px;
        }
        .card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
        }
        .input-field {
            border-bottom: 2px solid #3b82f6;
            transition: border-color 0.3s;
        }
        .input-field:focus {
            border-bottom-color: #1d4ed8;
            outline: none;
        }
        .log-button {
            transition: background-color 0.2s, transform 0.1s;
        }
        .log-button:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
        }
        .log-button:active {
            transform: translateY(0);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#60a5fa',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen py-8">
    <div class="container mx-auto px-4">
        <!-- HEADER -->
        <header class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-gray-800 tracking-tight">üèãÔ∏è Personal Gym Log</h1>
            <p class="text-gray-500 mt-2">Track your progress and manage your exercises with real-time data persistence.</p>
        </header>

        <div class="flex flex-col lg:flex-row gap-8">
            <!-- LEFT COLUMN: LOGGING & LIBRARY -->
            <div class="lg:w-1/2 space-y-8">
                
                <!-- WORKOUT LOGGING SECTION -->
                <section id="workout-logging-card" class="card bg-white p-6 rounded-xl border border-gray-200">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-700">Today's Workout</h2>

                    <!-- Exercise Selection Form -->
                    <div class="flex flex-col sm:flex-row gap-3 mb-4">
                        <select id="exercise-select" class="w-full sm:w-1/2 p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                            <option value="" disabled selected>Select or type exercise...</option>
                            <!-- Library options will be added here -->
                        </select>
                        <input type="text" id="custom-exercise-input" placeholder="Type new exercise name" class="w-full sm:w-1/2 p-3 border border-gray-300 rounded-lg input-field">
                    </div>

                    <!-- Set/Rep/Weight Inputs -->
                    <div class="grid grid-cols-3 gap-3 mb-4">
                        <input type="number" id="sets-input" placeholder="Sets" class="p-3 border border-gray-300 rounded-lg input-field text-center" min="1">
                        <input type="number" id="reps-input" placeholder="Reps" class="p-3 border border-gray-300 rounded-lg input-field text-center" min="1">
                        <input type="number" id="weight-input" placeholder="Weight (kg/lbs)" class="p-3 border border-gray-300 rounded-lg input-field text-center" min="0">
                    </div>

                    <button id="add-set-btn" class="w-full bg-indigo-500 text-white p-3 rounded-lg font-medium hover:bg-indigo-600 transition duration-150 shadow-md">
                        Add Set to Current Exercise
                    </button>

                    <div id="current-exercise-details" class="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 hidden">
                        <h3 class="text-lg font-medium text-gray-700 mb-2">Current Exercise: <span id="current-exercise-name" class="font-bold"></span></h3>
                        <div id="set-list" class="space-y-2">
                            <!-- Sets will be listed here -->
                        </div>
                        <button id="finish-exercise-btn" class="mt-3 w-full bg-yellow-500 text-white p-2 rounded-lg font-medium hover:bg-yellow-600 transition duration-150">
                            Finish Exercise
                        </button>
                    </div>

                    <div id="workout-summary" class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <h3 class="text-xl font-semibold text-blue-800 mb-2">Workout in Progress</h3>
                        <div id="completed-exercises-list" class="space-y-3">
                            <!-- Completed exercises for the current session go here -->
                            <p class="text-gray-600" id="no-exercises-message">Start adding exercises!</p>
                        </div>
                    </div>
                    
                    <button id="log-workout-btn" class="w-full log-button bg-green-500 text-white text-lg p-3 rounded-xl font-bold mt-6 hover:bg-green-600 transition duration-150 shadow-lg">
                        Log Workout
                    </button>
                    <p id="feedback-message" class="mt-2 text-center text-sm font-medium hidden text-green-600"></p>
                </section>
                
                <!-- EXERCISE LIBRARY MANAGEMENT SECTION -->
                <section id="library-management-card" class="card bg-white p-6 rounded-xl border border-gray-200">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-700">Exercise Library</h2>
                    <div class="flex gap-2 mb-4">
                        <input type="text" id="new-library-exercise-input" placeholder="New exercise name" class="flex-grow p-3 border border-gray-300 rounded-lg input-field">
                        <button id="add-library-btn" class="bg-primary text-white p-3 rounded-lg font-medium hover:bg-indigo-600 transition duration-150">
                            Add
                        </button>
                    </div>
                    <div id="exercise-library-list" class="space-y-2 max-h-64 overflow-y-auto p-2 bg-gray-50 rounded-lg border border-gray-200">
                        <!-- Library items displayed here -->
                    </div>
                </section>
                
            </div>

            <!-- RIGHT COLUMN: HISTORY -->
            <div class="lg:w-1/2">
                <section id="history-card" class="card bg-white p-6 rounded-xl border border-gray-200 min-h-full">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-700">Workout History</h2>
                    <p class="text-xs text-gray-500 mb-4">User ID: <span id="user-id-display" class="font-mono text-gray-700">Loading...</span></p>

                    <div id="workout-history-list" class="space-y-6">
                        <p id="loading-history" class="text-center text-gray-500">Loading history...</p>
                        <!-- Workout logs will be dynamically inserted here -->
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, doc, setDoc, onSnapshot, collection, query, 
            serverTimestamp, deleteDoc, runTransaction, getDocs 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- GLOBAL SETUP ---
        // Firestore will be used for all persistent data storage.
        
        // Global variables provided by the environment (Mandatory usage)
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-gym-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db;
        let auth;
        let userId = null;
        let isAuthReady = false;
        
        // State for the current workout session
        let currentExerciseName = null;
        let currentExerciseSets = [];
        let completedExercises = [];

        // DOM Elements
        const workoutSummary = document.getElementById('workout-summary');
        const setList = document.getElementById('set-list');
        const currentExerciseDetails = document.getElementById('current-exercise-details');
        const currentExerciseNameEl = document.getElementById('current-exercise-name');
        const completedExercisesList = document.getElementById('completed-exercises-list');
        const noExercisesMessage = document.getElementById('no-exercises-message');
        const exerciseSelect = document.getElementById('exercise-select');
        const newLibraryExerciseInput = document.getElementById('new-library-exercise-input');
        const exerciseLibraryList = document.getElementById('exercise-library-list');
        const feedbackMessage = document.getElementById('feedback-message');
        const userIdDisplay = document.getElementById('user-id-display');

        // --- UTILITY FUNCTIONS ---

        // Simple exponential backoff retry mechanism for API calls
        async function fetchWithRetry(apiCall, maxRetries = 3, delay = 1000) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    return await apiCall();
                } catch (error) {
                    if (i === maxRetries - 1) {
                        console.error("All retries failed for API call:", error);
                        throw error;
                    }
                    await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                }
            }
        }

        // --- 1. FIREBASE INITIALIZATION & AUTH ---

        async function initFirebaseAndAuth() {
            if (!firebaseConfig) {
                console.error("Firebase configuration is missing. Cannot initialize app.");
                userIdDisplay.textContent = 'ERROR: No Firebase Config.';
                return;
            }

            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            setLogLevel('debug'); // Enable detailed Firestore logging

            // Listen for auth state changes to determine userId
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    isAuthReady = true;
                    userIdDisplay.textContent = userId;
                    // Start loading data only after the user is authenticated/identified
                    loadLibrary();
                    loadHistory();
                } else {
                    // Sign in with the provided token or anonymously
                    try {
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            // Fallback to anonymous sign-in if no token is available
                            const anonUser = await signInAnonymously(auth);
                            userId = anonUser.user.uid;
                        }
                    } catch (error) {
                        console.error("Authentication failed:", error);
                        // Use a fallback random ID for unauthenticated state if sign-in fails
                        userId = crypto.randomUUID();
                        isAuthReady = true;
                        userIdDisplay.textContent = `${userId} (Anonymous/Fallback)`;
                        // Even with fallback, we still try to load data
                        loadLibrary();
                        loadHistory();
                    }
                }
            });
        }

        // --- 2. EXERCISE LIBRARY MANAGEMENT (CRUD) ---

        // RENDER LIBRARY
        function renderLibrary(library) {
            exerciseLibraryList.innerHTML = '';
            exerciseSelect.innerHTML = '<option value="" disabled selected>Select or type exercise...</option>';

            if (library.length === 0) {
                exerciseLibraryList.innerHTML = '<p class="text-sm text-gray-500 p-2">No exercises added yet. Use the input above to add one!</p>';
                return;
            }

            // Sort alphabetically for both display and dropdown
            library.sort((a, b) => a.name.localeCompare(b.name)).forEach(exercise => {
                // Display list item
                const item = document.createElement('div');
                item.className = 'flex justify-between items-center text-gray-700 bg-white p-2 rounded-lg border border-gray-200 text-sm';
                item.innerHTML = `
                    <span>${exercise.name}</span>
                    <button data-name="${exercise.name}" class="delete-library-btn text-red-500 hover:text-red-700 transition duration-150 p-1 rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                `;
                exerciseLibraryList.appendChild(item);

                // Add to dropdown
                const option = document.createElement('option');
                option.value = exercise.name;
                option.textContent = exercise.name;
                exerciseSelect.appendChild(option);
            });
        }

        // LOAD LIBRARY (Real-time listener)
        function loadLibrary() {
            if (!isAuthReady || !db) return;
            const libraryCollection = collection(db, `artifacts/${appId}/users/${userId}/exercise_library`);
            const q = query(libraryCollection);

            onSnapshot(q, (snapshot) => {
                const library = [];
                snapshot.forEach(doc => {
                    library.push(doc.data());
                });
                renderLibrary(library);
            }, (error) => {
                console.error("Error loading exercise library:", error);
                feedbackMessage.textContent = 'Error loading library. Check console for details.';
                feedbackMessage.classList.remove('hidden');
                feedbackMessage.classList.add('text-red-600');
            });
        }

        // ADD LIBRARY ITEM (Create)
        document.getElementById('add-library-btn').addEventListener('click', async () => {
            const name = newLibraryExerciseInput.value.trim();
            if (!name || !isAuthReady) return;

            try {
                // Use the exercise name as the document ID to prevent duplicates
                const docRef = doc(db, `artifacts/${appId}/users/${userId}/exercise_library`, name); 
                
                await fetchWithRetry(() => setDoc(docRef, { name: name }));

                newLibraryExerciseInput.value = '';
                feedbackMessage.textContent = `Added "${name}" to library!`;
                feedbackMessage.classList.remove('text-red-600', 'hidden');
                feedbackMessage.classList.add('text-green-600');
                setTimeout(() => feedbackMessage.classList.add('hidden'), 3000);

            } catch (e) {
                console.error("Error adding document: ", e);
                feedbackMessage.textContent = `Error adding "${name}": ${e.message}`;
                feedbackMessage.classList.remove('hidden');
                feedbackMessage.classList.add('text-red-600');
            }
        });

        // DELETE LIBRARY ITEM (Delete)
        exerciseLibraryList.addEventListener('click', async (e) => {
            if (e.target.closest('.delete-library-btn') && isAuthReady) {
                const button = e.target.closest('.delete-library-btn');
                const name = button.dataset.name;

                try {
                    const docRef = doc(db, `artifacts/${appId}/users/${userId}/exercise_library`, name);
                    await fetchWithRetry(() => deleteDoc(docRef));

                    feedbackMessage.textContent = `Removed "${name}" from library.`;
                    feedbackMessage.classList.remove('text-red-600', 'hidden');
                    feedbackMessage.classList.add('text-green-600');
                    setTimeout(() => feedbackMessage.classList.add('hidden'), 3000);
                } catch (e) {
                    console.error("Error removing document: ", e);
                    feedbackMessage.textContent = `Error removing "${name}": ${e.message}`;
                    feedbackMessage.classList.remove('hidden');
                    feedbackMessage.classList.add('text-red-600');
                }
            }
        });

        // --- 3. CURRENT WORKOUT SESSION LOGIC ---

        function updateCurrentExerciseDisplay() {
            setList.innerHTML = '';

            if (currentExerciseName) {
                currentExerciseNameEl.textContent = currentExerciseName;
                currentExerciseDetails.classList.remove('hidden');
                
                // Render the sets for the current exercise
                currentExerciseSets.forEach((set, index) => {
                    const setItem = document.createElement('div');
                    setItem.className = 'flex justify-between items-center bg-gray-100 p-2 rounded text-sm';
                    setItem.innerHTML = `
                        <span>Set ${index + 1}: ${set.sets}x${set.reps} @ ${set.weight}kg/lbs</span>
                        <button data-index="${index}" class="remove-set-btn text-red-400 hover:text-red-600 p-1 rounded-full">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    `;
                    setList.appendChild(setItem);
                });
            } else {
                currentExerciseDetails.classList.add('hidden');
            }
        }

        function updateWorkoutSummary() {
            completedExercisesList.innerHTML = '';
            if (completedExercises.length === 0) {
                noExercisesMessage.classList.remove('hidden');
            } else {
                noExercisesMessage.classList.add('hidden');
                completedExercises.forEach(exercise => {
                    const summaryItem = document.createElement('div');
                    summaryItem.className = 'bg-blue-100 p-3 rounded-lg';
                    let setsHtml = exercise.sets.map((set, index) => 
                        `<li class="text-sm">Set ${index + 1}: ${set.sets}x${set.reps} @ ${set.weight}</li>`
                    ).join('');
                    summaryItem.innerHTML = `
                        <h4 class="font-bold text-blue-900">${exercise.name} (${exercise.sets.length} sets)</h4>
                        <ul class="list-disc list-inside ml-2">${setsHtml}</ul>
                    `;
                    completedExercisesList.appendChild(summaryItem);
                });
            }
        }
        
        // ADD SET
        document.getElementById('add-set-btn').addEventListener('click', () => {
            let exerciseName = exerciseSelect.value || document.getElementById('custom-exercise-input').value.trim();
            const sets = parseInt(document.getElementById('sets-input').value);
            const reps = parseInt(document.getElementById('reps-input').value);
            const weight = parseFloat(document.getElementById('weight-input').value);

            if (!exerciseName || isNaN(sets) || isNaN(reps) || isNaN(weight) || sets <= 0 || reps <= 0) {
                feedbackMessage.textContent = "Please select an exercise and enter valid Sets, Reps, and Weight.";
                feedbackMessage.classList.remove('hidden', 'text-green-600');
                feedbackMessage.classList.add('text-red-600');
                return;
            }

            // If starting a new exercise, reset the sets list
            if (currentExerciseName !== exerciseName) {
                currentExerciseName = exerciseName;
                currentExerciseSets = [];
            }

            currentExerciseSets.push({ sets, reps, weight });

            // Clear inputs for the next set
            document.getElementById('sets-input').value = 1;
            document.getElementById('reps-input').value = '';
            document.getElementById('weight-input').value = '';

            updateCurrentExerciseDisplay();
        });

        // REMOVE SET
        setList.addEventListener('click', (e) => {
            if (e.target.closest('.remove-set-btn')) {
                const index = parseInt(e.target.closest('.remove-set-btn').dataset.index);
                currentExerciseSets.splice(index, 1);
                updateCurrentExerciseDisplay();
            }
        });

        // FINISH EXERCISE
        document.getElementById('finish-exercise-btn').addEventListener('click', () => {
            if (currentExerciseName && currentExerciseSets.length > 0) {
                completedExercises.push({
                    name: currentExerciseName,
                    sets: currentExerciseSets
                });

                // Reset current exercise state
                currentExerciseName = null;
                currentExerciseSets = [];
                
                updateCurrentExerciseDisplay();
                updateWorkoutSummary();
                
                // Reset form fields
                document.getElementById('custom-exercise-input').value = '';
                exerciseSelect.value = '';
                document.getElementById('sets-input').value = 1;
                document.getElementById('reps-input').value = '';
                document.getElementById('weight-input').value = '';
                
            } else {
                feedbackMessage.textContent = "Cannot finish. Add at least one set to the current exercise.";
                feedbackMessage.classList.remove('hidden', 'text-green-600');
                feedbackMessage.classList.add('text-red-600');
                setTimeout(() => feedbackMessage.classList.add('hidden'), 3000);
            }
        });

        // LOG WORKOUT (Create)
        document.getElementById('log-workout-btn').addEventListener('click', async () => {
            if (completedExercises.length === 0 || !isAuthReady) {
                feedbackMessage.textContent = "Please add exercises to your workout before logging.";
                feedbackMessage.classList.remove('hidden', 'text-green-600');
                feedbackMessage.classList.add('text-red-600');
                setTimeout(() => feedbackMessage.classList.add('hidden'), 3000);
                return;
            }

            const logWorkoutBtn = document.getElementById('log-workout-btn');
            logWorkoutBtn.textContent = 'Logging...';
            logWorkoutBtn.disabled = true;

            const exercises = completedExercises;

            try {
                const workoutId = crypto.randomUUID();
                const workoutRef = doc(db, `artifacts/${appId}/users/${userId}/workouts`, workoutId);

                await fetchWithRetry(() => setDoc(workoutRef, {
                    exercises: exercises,
                    timestamp: serverTimestamp(),
                    date: new Date().toLocaleDateString('en-US'),
                    id: workoutId
                }));

                // Reset session state after successful log
                completedExercises = [];
                updateWorkoutSummary();
                
                feedbackMessage.textContent = 'Workout successfully logged!';
                feedbackMessage.classList.remove('text-red-600', 'hidden');
                feedbackMessage.classList.add('text-green-600');

            } catch (e) {
                console.error("Error logging workout: ", e);
                feedbackMessage.textContent = `Error logging workout: ${e.message}`;
                feedbackMessage.classList.remove('text-green-600', 'hidden');
                feedbackMessage.classList.add('text-red-600');
            } finally {
                logWorkoutBtn.textContent = 'Log Workout';
                logWorkoutBtn.disabled = false;
                setTimeout(() => {
                    feedbackMessage.classList.add('hidden');
                    feedbackMessage.classList.remove('text-red-600');
                    feedbackMessage.classList.add('text-green-600');
                }, 5000);
            }
        });

        // --- 4. HISTORY DISPLAY (Read & Delete) ---

        function renderHistory(workouts) {
            const workoutHistoryList = document.getElementById('workout-history-list');
            workoutHistoryList.innerHTML = '';

            if (workouts.length === 0) {
                workoutHistoryList.innerHTML = '<p class="text-center text-gray-500 p-4">No workout history logged yet.</p>';
                return;
            }

            // Sort by timestamp (newest first)
            workouts.sort((a, b) => b.timestamp?.seconds - a.timestamp?.seconds).forEach(workout => {
                const workoutItem = document.createElement('div');
                workoutItem.className = 'bg-gray-100 p-4 rounded-xl border border-gray-200';

                let exercisesHtml = workout.exercises.map(exercise => {
                    let setsHtml = exercise.sets.map((set, index) => 
                        `<li class="text-xs text-gray-600">Set ${index + 1}: ${set.sets}x${set.reps} @ ${set.weight}</li>`
                    ).join('');

                    return `
                        <div class="mt-2">
                            <h4 class="font-semibold text-gray-800">${exercise.name} (${exercise.sets.length} sets)</h4>
                            <ul class="list-none space-y-0.5 ml-1">${setsHtml}</ul>
                        </div>
                    `;
                }).join('');

                workoutItem.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-lg font-bold text-gray-700">${workout.date}</h3>
                        <button data-id="${workout.id}" class="delete-workout-btn text-red-500 hover:text-red-700 transition duration-150 p-1 rounded-full" title="Delete Workout">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                    <div class="border-t border-gray-300 pt-2">${exercisesHtml}</div>
                `;
                workoutHistoryList.appendChild(workoutItem);
            });
            document.getElementById('loading-history').classList.add('hidden');
        }

        // LOAD HISTORY (Real-time listener)
        function loadHistory() {
            if (!isAuthReady || !db) return;
            const workoutsCollection = collection(db, `artifacts/${appId}/users/${userId}/workouts`);
            const q = query(workoutsCollection);

            onSnapshot(q, (snapshot) => {
                const workouts = [];
                snapshot.forEach(doc => {
                    workouts.push(doc.data());
                });
                renderHistory(workouts);
            }, (error) => {
                console.error("Error loading workout history:", error);
                document.getElementById('loading-history').textContent = 'Error loading history.';
            });
        }

        // DELETE WORKOUT (Delete)
        document.getElementById('workout-history-list').addEventListener('click', async (e) => {
            if (e.target.closest('.delete-workout-btn') && isAuthReady) {
                const button = e.target.closest('.delete-workout-btn');
                const workoutId = button.dataset.id;
                
                // Simple confirmation logic (replace with modal UI in production)
                // Since alerts are forbidden, we rely on the user understanding the button click
                
                try {
                    const docRef = doc(db, `artifacts/${appId}/users/${userId}/workouts`, workoutId);
                    await fetchWithRetry(() => deleteDoc(docRef));

                    feedbackMessage.textContent = 'Workout log deleted.';
                    feedbackMessage.classList.remove('text-red-600', 'hidden');
                    feedbackMessage.classList.add('text-green-600');
                    setTimeout(() => feedbackMessage.classList.add('hidden'), 3000);
                } catch (e) {
                    console.error("Error deleting workout: ", e);
                    feedbackMessage.textContent = `Error deleting workout: ${e.message}`;
                    feedbackMessage.classList.remove('hidden');
                    feedbackMessage.classList.add('text-red-600');
                }
            }
        });

        // Initialize on window load
        window.onload = function () {
            initFirebaseAndAuth();
        }

    </script>
</body>
</html>
