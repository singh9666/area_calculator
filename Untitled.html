<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gym Workout Tracker</title>

<!-- React CDN -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

<!-- Firebase UMD -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>

<style>
body { font-family: 'Segoe UI', sans-serif; margin:0; padding:0; background:#f0f4f8; color:#333; }
header { background: linear-gradient(90deg, #ff7e5f, #feb47b); padding:15px 20px; display:flex; justify-content:space-between; align-items:center; color:#fff; }
header h1 { margin:0; font-size:24px; }
button { cursor:pointer; padding:6px 12px; margin:4px; border:none; border-radius:6px; transition:0.2s; font-weight:600; }
button:hover { opacity:0.85; }
input, select { padding:8px; margin:5px 0; border-radius:6px; border:1px solid #ccc; width:100%; }
.container { max-width:900px; margin:20px auto; padding:15px; background:#fff; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
h2 { margin-top:0; margin-bottom:10px; color:#ff7e5f; display:flex; align-items:center; gap:8px; }
table { width:100%; border-collapse:collapse; margin:10px 0; }
table, th, td { border:1px solid #ddd; }
th, td { padding:8px; text-align:left; }
.flex { display:flex; flex-wrap:wrap; gap:10px; }
.flex input, .flex select { flex:1; }
label { display:flex; align-items:center; gap:5px; }
.progress-bar-bg { background:#eee; border-radius:6px; height:16px; width:100%; margin-top:5px; overflow:hidden; }
.progress-bar-fill { background:#4CAF50; height:100%; width:0; border-radius:6px; transition: width 0.5s ease; }
.card { padding:12px; border-radius:12px; background:#fafafa; box-shadow:0 2px 8px rgba(0,0,0,0.08); margin-bottom:15px; }
.logout-btn { background:#ff4d4d; color:#fff; }
.add-btn { background:#4CAF50; color:#fff; }
.delete-btn { background:#ff5e5e; color:#fff; }
@media(max-width:600px){
  .flex { flex-direction:column; }
  button { width:100%; }
}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

// Firebase Setup
const firebaseConfig = {
  apiKey: "AIzaSyBuFnHHyghKrq0cift2_DTjpoXNWo9Dwqw",
  authDomain: "gymlog-3ef3b.firebaseapp.com",
  projectId: "gymlog-3ef3b",
  storageBucket: "gymlog-3ef3b.firebasestorage.app",
  messagingSenderId: "139587565969",
  appId: "1:139587565969:web:90bf938d213afbc81e0230",
  measurementId: "G-5DZYYM4YN2"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

function App() {
  const [user,setUser] = useState(null);
  useEffect(()=>{ const unsubscribe = auth.onAuthStateChanged(u=>setUser(u)); return ()=>unsubscribe(); },[]);
  if(!user) return <Login />;
  return <Dashboard user={user} />;
}

function Login(){
  const [email,setEmail] = useState('');
  const [password,setPassword] = useState('');
  const [mode,setMode] = useState('login');
  const [error,setError] = useState('');

  const handleSubmit = async () => {
    setError('');
    try{
      if(mode==='login') await auth.signInWithEmailAndPassword(email,password);
      else await auth.createUserWithEmailAndPassword(email,password);
    }catch(e){ setError(e.message); }
  }

  return (
    <div className="container card">
      <h2><i className="fas fa-dumbbell"></i> {mode==='login'?'Login':'Register'}</h2>
      <input type="email" placeholder="Email" value={email} onChange={e=>setEmail(e.target.value)} />
      <input type="password" placeholder="Password" value={password} onChange={e=>setPassword(e.target.value)} />
      <button className="add-btn" onClick={handleSubmit}>{mode==='login'?'Login':'Register'}</button>
      {error && <p style={{color:'red'}}>{error}</p>}
      <p>{mode==='login'?'No account?':'Already have account?'}
        <button style={{background:'#ffa500'}} onClick={()=>setMode(mode==='login'?'register':'login')}>
          {mode==='login'?'Register':'Login'}
        </button>
      </p>
    </div>
  )
}

function Dashboard({user}){
  const [exercises,setExercises] = useState([]);
  const [newExercise,setNewExercise] = useState('');
  const [workouts,setWorkouts] = useState([]);
  const [selectedWorkout,setSelectedWorkout] = useState('');
  const [sets,setSets] = useState([]);
  const [exerciseInput,setExerciseInput] = useState('');
  const [repsInput,setRepsInput] = useState('');
  const [weightInput,setWeightInput] = useState('');
  const [supersetInput,setSupersetInput] = useState(false);

  const loadExercises = async ()=>{ const snapshot = await db.collection('exercises').where('uid','==',user.uid).get(); setExercises(snapshot.docs.map(d=>({id:d.id,name:d.data().name}))); }
  const loadWorkouts = async ()=>{ const snapshot = await db.collection('workouts').where('uid','==',user.uid).orderBy('date','desc').get(); setWorkouts(snapshot.docs.map(d=>({id:d.id,...d.data()}))); }

  useEffect(()=>{ loadExercises(); loadWorkouts(); },[]);

  const totalWorkouts = workouts.length;
  const totalSets = workouts.reduce((acc,w)=>acc+w.sets?.length||0,0);
  const heaviestLifts = {};
  workouts.forEach(w=>{ w.sets?.forEach(s=>{ if(!heaviestLifts[s.exercise] || s.weight>heaviestLifts[s.exercise]) heaviestLifts[s.exercise]=s.weight; }) });
  const recentWorkouts = workouts.slice(0,5);
  const maxWeight = Math.max(...Object.values(heaviestLifts),1);

  const handleAddExercise = async ()=>{ if(!newExercise) return; await db.collection('exercises').add({name:newExercise,uid:user.uid}); setNewExercise(''); await loadExercises(); }
  const handleDeleteExercise = async id=>{ await db.collection('exercises').doc(id).delete(); await loadExercises(); }
  const handleAddSet = ()=>{ if(!exerciseInput || !repsInput || !weightInput) return; setSets([...sets,{exercise:exerciseInput,reps:repsInput,weight:weightInput,superset:supersetInput}]); setExerciseInput(''); setRepsInput(''); setWeightInput(''); setSupersetInput(false);}
  const handleSaveWorkout = async ()=>{ if(!selectedWorkout || sets.length===0) return; const date=new Date().toISOString(); await db.collection('workouts').add({uid:user.uid,name:selectedWorkout,sets,date}); setSelectedWorkout(''); setSets([]); await loadWorkouts(); }
  const handleLogout = async ()=>{ await auth.signOut(); }

  return (
    <div>
      <header>
        <h1><i className="fas fa-dumbbell"></i> Gym Tracker</h1>
        <button className="logout-btn" onClick={handleLogout}><i className="fas fa-sign-out-alt"></i> Logout</button>
      </header>

      {/* Stats */}
      <div className="container card">
        <h2><i className="fas fa-chart-line"></i> Stats</h2>
        <p><strong>Total Workouts:</strong> {totalWorkouts}</p>
        <p><strong>Total Sets:</strong> {totalSets}</p>
        <h4>Heaviest Lifts:</h4>
        {Object.keys(heaviestLifts).length===0 && <p>No lifts yet.</p>}
        {Object.keys(heaviestLifts).map(ex=>{ const widthPercent=Math.round((heaviestLifts[ex]/maxWeight)*100); return (
          <div key={ex} style={{marginBottom:'10px'}}>
            <div style={{display:'flex', justifyContent:'space-between'}}>
              <span>{ex}: {heaviestLifts[ex]} kg</span><span>{widthPercent}%</span>
            </div>
            <div className="progress-bar-bg"><div className="progress-bar-fill" style={{width:`${widthPercent}%`}}></div></div>
          </div>
        )})}
        <h4>Recent Workouts:</h4>
        {recentWorkouts.length===0 && <p>No recent workouts.</p>}
        <ul>{recentWorkouts.map(w=><li key={w.id||w.date}><i className="fas fa-calendar-alt"></i> {w.name} - {new Date(w.date).toLocaleDateString()}</li>)}</ul>
      </div>

      {/* Exercises */}
      <div className="container card">
        <h2><i className="fas fa-dumbbell"></i> Exercises</h2>
        {exercises.map(e=><div key={e.id} className="flex"><span>{e.name}</span><button className="delete-btn" onClick={()=>handleDeleteExercise(e.id)}><i className="fas fa-trash"></i> Delete</button></div>)}
        <div className="flex">
          <input placeholder="New Exercise" value={newExercise} onChange={e=>setNewExercise(e.target.value)}/>
          <button className="add-btn" onClick={handleAddExercise}><i className="fas fa-plus"></i> Add</button>
        </div>
      </div>

      {/* Log Workout */}
      <div className="container card">
        <h2><i className="fas fa-clipboard-list"></i> Log Workout</h2>
        <input placeholder="Workout Name (Push/Pull/Legs)" value={selectedWorkout} onChange={e=>setSelectedWorkout(e.target.value)}/>
        <div className="flex">
          <select value={exerciseInput} onChange={e=>setExerciseInput(e.target.value)}>
            <option value="">Select Exercise</option>{exercises.map(e=><option key={e.id} value={e.name}>{e.name}</option>)}
          </select>
          <input type="number" placeholder="Reps" value={repsInput} onChange={e=>setRepsInput(e.target.value)}/>
          <input type="number" placeholder="Weight (kg)" value={weightInput} onChange={e=>setWeightInput(e.target.value)}/>
          <label><input type="checkbox" checked={supersetInput} onChange={e=>setSupersetInput(e.target.checked)}/> Superset</label>
          <button className="add-btn" onClick={handleAddSet}><i className="fas fa-plus"></i> Add Set</button>
        </div>
        {sets.length>0 && <table><thead><tr><th>Exercise</th><th>Reps</th><th>Weight</th><th>Superset</th></tr></thead>
        <tbody>{sets.map((s,i)=><tr key={i}><td>{s.exercise}</td><td>{s.reps}</td><td>{s.weight}</td><td>{s.superset?'Yes':'No'}</td></tr>)}</tbody></table>}
        <button className="add-btn" onClick={handleSaveWorkout}><i className="fas fa-save"></i> Save Workout</button>
      </div>

      {/* Workout History */}
      <div className="container card">
        <h2><i className="fas fa-history"></i> Workout History</h2>
        {workouts.length===0 && <p>No workouts logged yet.</p>}
        {workouts.map(w=><div key={w.id||w.date} className="card">
          <strong>{w.name}</strong> - {new Date(w.date).toLocaleString()}
          <table>
            <thead><tr><th>Exercise</th><th>Reps</th><th>Weight</th><th>Superset</th></tr></thead>
            <tbody>{Array.isArray(w.sets) && w.sets.map((s,i)=><tr key={i}><td>{s.exercise}</td><td>{s.reps}</td><td>{s.weight}</td><td>{s.superset?'Yes':'No'}</td></tr>)}</tbody>
          </table>
        </div>)}
      </div>
    </div>
  )
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
