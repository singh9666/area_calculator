<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gym Workout Logger</title>
  <!-- React CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <!-- Firebase CDN -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, orderBy, where } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    window.firebaseApp = initializeApp({
      apiKey: "AIzaSyBuFnHHyghKrq0cift2_DTjpoXNWo9Dwqw",
      authDomain: "gymlog-3ef3b.firebaseapp.com",
      projectId: "gymlog-3ef3b",
      storageBucket: "gymlog-3ef3b.firebasestorage.app",
      messagingSenderId: "139587565969",
      appId: "1:139587565969:web:90bf938d213afbc81e0230",
      measurementId: "G-5DZYYM4YN2"
    });

    window.auth = getAuth(window.firebaseApp);
    window.db = getFirestore(window.firebaseApp);
  </script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #fdf6e3; color: #333; }
    header { background: #ffb347; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
    header h1 { margin: 0; font-size: 24px; color: #fff; }
    button { cursor: pointer; padding: 5px 10px; margin: 5px; border: none; border-radius: 4px; background: #ff7e5f; color: white; }
    input, select { padding: 5px; margin: 5px 0; border-radius: 4px; border: 1px solid #ccc; width: 100%; }
    .container { max-width: 900px; margin: 20px auto; padding: 10px; background: #fff9f0; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h2 { margin-top: 0; }
    table { width: 100%; border-collapse: collapse; margin: 10px 0; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 8px; text-align: left; }
    .exercise-list, .workout-list { margin-bottom: 20px; }
    .flex { display: flex; flex-wrap: wrap; gap: 10px; }
    .flex input { flex: 1; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">

const { useState, useEffect } = React;

function App() {
  const [user, setUser] = useState(null);
  const [view, setView] = useState('login');

  useEffect(() => {
    onAuthStateChanged(auth, (u) => {
      if(u) {
        setUser(u);
        setView('dashboard');
      } else {
        setUser(null);
        setView('login');
      }
    });
  }, []);

  if(!user) {
    return <Login setView={setView} />;
  }

  return <Dashboard user={user} />;
}

function Login({ setView }) {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [mode, setMode] = useState('login'); // login or register
  const [error, setError] = useState('');

  const handleSubmit = async () => {
    try {
      setError('');
      if(mode === 'login') {
        await signInWithEmailAndPassword(auth, email, password);
      } else {
        await createUserWithEmailAndPassword(auth, email, password);
      }
    } catch(e) {
      setError(e.message);
    }
  }

  return (
    <div className="container">
      <h2>{mode === 'login' ? 'Login' : 'Register'}</h2>
      <input type="email" placeholder="Email" value={email} onChange={e=>setEmail(e.target.value)} />
      <input type="password" placeholder="Password" value={password} onChange={e=>setPassword(e.target.value)} />
      <button onClick={handleSubmit}>{mode === 'login' ? 'Login' : 'Register'}</button>
      {error && <p style={{color:'red'}}>{error}</p>}
      <p>
        {mode==='login' ? 'No account?' : 'Already have account?'} 
        <button onClick={()=>setMode(mode==='login'?'register':'login')} style={{background:'#ffa500'}}>{mode==='login'?'Register':'Login'}</button>
      </p>
    </div>
  );
}

function Dashboard({ user }) {
  const [exercises, setExercises] = useState([]);
  const [newExercise, setNewExercise] = useState('');
  const [workouts, setWorkouts] = useState([]);
  const [selectedWorkout, setSelectedWorkout] = useState('');
  const [sets, setSets] = useState([]);
  const [exerciseInput, setExerciseInput] = useState('');
  const [repsInput, setRepsInput] = useState('');
  const [weightInput, setWeightInput] = useState('');
  const [supersetInput, setSupersetInput] = useState(false);

  // Load exercises from Firestore
  useEffect(()=>{
    const fetchExercises = async () => {
      const q = query(collection(db, 'exercises'), where('uid','==',user.uid));
      const snapshot = await getDocs(q);
      if(snapshot.empty) {
        // Add default exercises
        const defaultExercises = ['Bench Press','Squat','Deadlift'];
        defaultExercises.forEach(async ex => {
          await addDoc(collection(db,'exercises'),{name:ex, uid:user.uid});
        });
        setExercises(defaultExercises.map((name,i)=>({id:i,name})));
      } else {
        setExercises(snapshot.docs.map(doc=>({id:doc.id, name:doc.data().name})));
      }
    }
    fetchExercises();
  },[]);

  // Load workouts from Firestore
  useEffect(()=>{
    const fetchWorkouts = async () => {
      const q = query(collection(db,'workouts'), where('uid','==',user.uid), orderBy('date','desc'));
      const snapshot = await getDocs(q);
      setWorkouts(snapshot.docs.map(doc=>({id:doc.id, ...doc.data()})));
    }
    fetchWorkouts();
  },[]);

  const addExercise = async () => {
    if(!newExercise) return;
    const docRef = await addDoc(collection(db,'exercises'), {name:newExercise, uid:user.uid});
    setExercises([...exercises,{id:docRef.id,name:newExercise}]);
    setNewExercise('');
  }

  const deleteExercise = async (id) => {
    await deleteDoc(doc(db,'exercises',id));
    setExercises(exercises.filter(e=>e.id!==id));
  }

  const addSet = () => {
    if(!exerciseInput || !repsInput || !weightInput) return;
    setSets([...sets,{exercise:exerciseInput,reps:repsInput,weight:weightInput,superset:supersetInput}]);
    setExerciseInput(''); setRepsInput(''); setWeightInput(''); setSupersetInput(false);
  }

  const saveWorkout = async () => {
    if(!selectedWorkout || sets.length===0) return;
    const date = new Date().toISOString();
    await addDoc(collection(db,'workouts'),{uid:user.uid, name:selectedWorkout, sets, date});
    setWorkouts([{name:selectedWorkout, sets, date}, ...workouts]);
    setSets([]); setSelectedWorkout('');
  }

  const logout = async () => {
    await signOut(auth);
  }

  return (
    <div>
      <header>
        <h1>Gym Workout Logger</h1>
        <button onClick={logout}>Logout</button>
      </header>
      <div className="container">
        <h2>Exercises</h2>
        <div className="exercise-list">
          {exercises.map(e=>(
            <div key={e.id} className="flex">
              <span>{e.name}</span>
              <button onClick={()=>deleteExercise(e.id)} style={{background:'#ff4d4d'}}>Delete</button>
            </div>
          ))}
        </div>
        <div className="flex">
          <input placeholder="New Exercise" value={newExercise} onChange={e=>setNewExercise(e.target.value)} />
          <button onClick={addExercise}>Add Exercise</button>
        </div>
      </div>

      <div className="container">
        <h2>Log Workout</h2>
        <input placeholder="Workout Name (Push/Pull/Legs)" value={selectedWorkout} onChange={e=>setSelectedWorkout(e.target.value)} />
        <div className="flex">
          <select value={exerciseInput} onChange={e=>setExerciseInput(e.target.value)}>
            <option value="">Select Exercise</option>
            {exercises.map(e=><option key={e.id} value={e.name}>{e.name}</option>)}
          </select>
          <input placeholder="Reps" type="number" value={repsInput} onChange={e=>setRepsInput(e.target.value)} />
          <input placeholder="Weight (kg)" type="number" value={weightInput} onChange={e=>setWeightInput(e.target.value)} />
          <label>
            <input type="checkbox" checked={supersetInput} onChange={e=>setSupersetInput(e.target.checked)} />
            Superset
          </label>
          <button onClick={addSet}>Add Set</button>
        </div>
        {sets.length>0 && (
          <table>
            <thead>
              <tr><th>Exercise</th><th>Reps</th><th>Weight</th><th>Superset</th></tr>
            </thead>
            <tbody>
              {sets.map((s,i)=>(
                <tr key={i}><td>{s.exercise}</td><td>{s.reps}</td><td>{s.weight}</td><td>{s.superset?'Yes':'No'}</td></tr>
              ))}
            </tbody>
          </table>
        )}
        <button onClick={saveWorkout} style={{background:'#4CAF50'}}>Save Workout</button>
      </div>

      <div className="container">
        <h2>Workout History</h2>
        {workouts.length===0 && <p>No workouts logged yet.</p>}
        {workouts.map(w=>(
          <div key={w.id || w.date} style={{border:'1px solid #ccc', margin:'5px 0', padding:'5px', borderRadius:'4px'}}>
            <strong>{w.name}</strong> - {new Date(w.date).toLocaleString()}
            <table>
              <thead>
                <tr><th>Exercise</th><th>Reps</th><th>Weight</th><th>Superset</th></tr>
              </thead>
              <tbody>
                {w.sets.map((s,i)=>(
                  <tr key={i}><td>{s.exercise}</td><td>{s.reps}</td><td>{s.weight}</td><td>{s.superset?'Yes':'No'}</td></tr>
                ))}
              </tbody>
            </table>
          </div>
        ))}
      </div>
    </div>
  )
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
